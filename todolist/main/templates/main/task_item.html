<div 
    class="list-item w-100 p-0 task" 
    id="task-{{ task.id }}" 
    data-category-ids="{% for category in task.categories.all %}{{ category.id }}{% if not forloop.last %},{% endif %}{% endfor %}"
    data-is-high-priority="{{ task.is_high_priority }}"
    style="display: flex;">

    <!-- Project Color -->
    <div class="project-color" style="{% if task.project.color %} background-color: {{ task.project.color }}{% endif %}"></div>

    <!-- Task content -->
    <div class="d-flex flex-column w-100 pt-2 px-1 px-sm-3 gap-2 position-relative">

        <!-- Edit icon -->
        <i 
            class="bi bi-pencil-square edit-icon ms-auto pointer" 
            data-close-id="task-{{ task.id }}" 
            data-open-id="edit-task-{{ task.id }}"
            onclick="openCloseWindows(this)">
        </i>

        <!-- Top row -->
        <div class="task-top d-flex flex-wrap align-items-center">

            <!-- Checkmark -->
            <i 
                class="bi {% if task.is_completed %}bi-check-circle-fill{% else %}bi-circle pointer{% endif %} checkmark" 
                {% if not task.is_completed %}
                    data-task-id="{{ task.id }}" 
                    onclick="completeTask(this)"
                {% endif %}>
            </i>

            <!-- Title -->
            <div class="{% if task.is_completed %}opacity-50{% endif %} d-flex align-items-center gap-2 flex-wrap">
                {% if task.is_completed or task.is_overdue %}
                    <span style="font-size: small;">
                        {% if task.is_completed %}
                            (Completed)
                        {% elif task.is_overdue %}
                            <span class="text-danger">Overdue!</span>
                        {% endif %}
                    </span>
                {% endif %}
                <h5 class="task-title">{{ task.title }}</h5>
            </div>
            
            <!-- Categories -->
            {% if task.categories %} 
                {% for category in task.categories.all %} 
                    <span class="badge change-text-color shadow-sm" style="font-size: 11px; background-color: {{ category.color }}; border: 1px solid #aaa;"> 
                        {{category.title }} 
                    </span>
                {% endfor %}
            {% endif %}

            <!-- High priority flag -->
            {% if task.is_high_priority %}
                <i class="bi bi-flag-fill" style="font-size: 20px;"></i>
            {% else %}
                <i class="bi bi-flag" style="font-size: 20px;"></i>
            {% endif %}
        </div>
        

        <!-- Description -->
        <p class="ms-4 mb-0 {% if task.is_completed %}opacity-50{% endif %}">
            {{task.text}}
        </p>

        <!-- Due date -->
        <div class="d-flex justify-content-end">
            <div class="me-2 opacity-50">{% if task.project %}{{ task.project }}{% endif %}</div>
            <div {% if task.is_overdue %}class="text-danger"{% endif %}>{{ task.due_date|date:"d/m" }}</div>
        </div>
    </div>
</div>